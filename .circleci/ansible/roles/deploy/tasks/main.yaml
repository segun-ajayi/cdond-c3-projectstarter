#---
#- name: 'Update/Upgrade Packages'
#  become: yes
#  apt:
#      upgrade: yes
#      update_cache: yes
#      cache_valid_time: 86400
#- name: 'remove unneeded Dependencies'
#  become: yes
#  apt:
#    autoremove: yes
#- name: Install Dependencies
#  become: yes
#  apt:
#    name: ['nodejs, npm']
#    state: latest
#    update_cache: yes
#- name: Install PM2
#  become: yes
#  npm:
#    name: pm2
#    global: yes
#    state: latest
#    production: yes
#- name: extract artifact
#  become: yes
#  unarchive:
#    src: files/artifact.tar.gz
#    dest: .
#- name: Start APP
#  become: yes
#  shell: |
#    pm2 stop all
#    pm2 start npm -- start

- name: "unarchive backend files"
  unarchive:
    src: api.tar.gz
    dest: /home/ubuntu/

- name: "executing node"
  shell: |
    cd /home/ubuntu/backend/dist
    pm2 stop default
    pm2 start npm --name 'udapeople' -- start
    pm2 ls
